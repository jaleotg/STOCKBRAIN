{% load static %}
{% with admin_header=admin_header|default_if_none:False %}
{% with logout_view=sb_header_logout_view|default:"logout" %}
{% with show_user_edit=sb_header_show_user_edit|default_if_none:True %}
{% url 'home' as home_url %}
{% url 'home_alias' as home_alias_url %}
{% url 'work_log' as work_log_url %}
{% url 'work_log_locations' as wl_locations_url %}
{% url 'work_log_master' as wl_master_url %}
{% url 'admin:index' as admin_index_url %}
{% with current_name=request.resolver_match.url_name|default:'' %}
<header class="sb-header">
    <div class="sb-header-left">
        <div class="sb-header-title">
            DesertBrain<span class="sb-header-mark">&reg;</span>
        </div>
        {% if request.user.is_authenticated %}
            <nav class="sb-header-nav">
                <a href="{{ home_url }}"
                   class="sb-link {% if current_name == 'home' or current_name == 'home_alias' %}sb-link-active{% endif %}">
                    Inventory
                </a>

                <div class="sb-dropdown {% if current_name|slice:'0:8' == 'work_log' %}sb-dropdown-active{% endif %}">
                    <a href="{{ work_log_url }}"
                       class="sb-drop-trigger {% if current_name|slice:'0:8' == 'work_log' %}sb-link-active{% endif %}">
                        Works
                    </a>
                    <div class="sb-dropdown-menu">
                        <div class="sb-dropdown-row">
                            <a href="{{ work_log_url }}"
                               class="sb-dropdown-item sb-dropdown-item-main {% if current_name == 'work_log' %}sb-dd-active{% endif %}">
                                WL List
                            </a>
                            <a href="{{ work_log_url }}?add=1"
                               id="sb-wl-add-inline"
                               class="sb-dd-add-btn"
                               title="Add work log">
                                <span class="sb-plus-icon">+</span>
                                <span class="sb-dd-add-label">add</span>
                            </a>
                        </div>
                        <a href="{{ wl_locations_url }}"
                           class="sb-dropdown-item {% if current_name == 'work_log_locations' %}sb-dd-active{% endif %}">
                            Issues
                        </a>
                        {% if has_work_log_master %}
                            <a href="{{ wl_master_url }}"
                               class="sb-dropdown-item {% if current_name == 'work_log_master' %}sb-dd-active{% endif %}">
                                Master
                            </a>
                        {% endif %}
                    </div>
                </div>

                {% if request.user.is_staff %}
                    {% if admin_header %}
                        <a href="{{ admin_index_url }}" class="sb-link sb-link-active">
                            Backend
                        </a>
                    {% else %}
                        <a href="{{ admin_index_url }}" class="sb-link">
                            Backend
                        </a>
                    {% endif %}
                {% endif %}
            </nav>
        {% endif %}
    </div>

    <div class="sb-header-right">
{% if not admin_header and request.user.is_authenticated and standard_end_time %}
        <div class="sb-gtfo-wrap">
            <span class="sb-tea-steam" aria-hidden="true">‚òï</span>
            <span class="sb-lunch-steam" aria-hidden="true">üçΩÔ∏è</span>
            <span class="sb-work-gears" aria-hidden="true"></span>
            <a href="{{ work_log_url }}?add=1" class="sb-worklog-cta" aria-hidden="true">
                CREATE a WORKLOG
            </a>
            <span class="sb-countdown-label">GTFO in</span>
            <span class="sb-countdown"
                  data-start="{{ standard_start_time }}"
                  data-end="{{ standard_end_time }}">
                --
            </span>
            <div class="sb-gtfo-popup" aria-live="polite"></div>
            {% if request.user.username == "leo-admin" %}
                <select class="sb-gtfo-override" id="sb-gtfo-override">
                    <option value="">-----</option>
                    <option value="Personal Time">Personal Time</option>
                    <option value="Tea Time">Tea Time</option>
                    <option value="Lunch Time">Lunch Time</option>
                    <option value="Work Time">Work Time</option>
                    <option value="Work Log Time">Work Log Time</option>
                    {% for type_name in sb_poetry_types %}
                        <option value="{{ type_name|title }}">{{ type_name|title }}</option>
                    {% endfor %}
                </select>
            {% endif %}
        </div>
        {% endif %}
        {% if request.user.is_authenticated %}
            <button type="button" class="sb-mobile-menu-btn" id="sb-mobile-menu-btn" aria-label="Open menu">
                ‚ò∞
            </button>
            <div class="sb-dropdown">
                <a href="#"
                   class="sb-drop-trigger">
                    {{ request.user.username }}
                </a>
                <div class="sb-dropdown-menu" style="right:0; left:auto;">
                    <a href="#"
                       id="sb-user-edit-trigger"
                       class="sb-dropdown-item">
                        User account
                    </a>
                    <a href="#"
                       id="sb-user-settings-trigger"
                       class="sb-dropdown-item">
                        Settings
                    </a>
                    {% if admin_header %}
                        <form method="post" action="{% url logout_view %}" class="sb-dropdown-form">
                            {% csrf_token %}
                            {% if logout_view == 'admin:logout' %}
                                <input type="hidden" name="next" value="{% url 'login' %}">
                            {% endif %}
                            <button type="submit" class="sb-dropdown-item sb-dropdown-btn-link">
                                Logout
                            </button>
                        </form>
                    {% else %}
                        <a href="{% url logout_view %}" class="sb-dropdown-item">Logout</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</header>
{% if request.user.is_authenticated %}
<div class="sb-mobile-menu" id="sb-mobile-menu" aria-hidden="true">
    <div class="sb-mobile-menu-panel">
        <button type="button" class="sb-mobile-menu-close" id="sb-mobile-menu-close" aria-label="Close menu">‚úï</button>
        <nav class="sb-mobile-menu-list">
            <a href="{{ home_url }}" class="sb-mobile-menu-link">Inventory</a>
            <a href="{{ work_log_url }}" class="sb-mobile-menu-link">Works</a>
            <a href="{{ wl_locations_url }}" class="sb-mobile-menu-link">Issues</a>
            {% if has_work_log_master %}
                <a href="{{ wl_master_url }}" class="sb-mobile-menu-link">Master</a>
            {% endif %}
            {% if request.user.is_staff %}
                <a href="{{ admin_index_url }}" class="sb-mobile-menu-link">Backend</a>
            {% endif %}
        </nav>
        <div class="sb-mobile-menu-divider"></div>
        <div class="sb-mobile-menu-list">
            <button type="button" class="sb-mobile-menu-item" id="sb-mobile-user-trigger">User account</button>
            <button type="button" class="sb-mobile-menu-item" id="sb-mobile-settings-trigger">Settings</button>
            {% if admin_header %}
                <form method="post" action="{% url logout_view %}" class="sb-mobile-menu-form">
                    {% csrf_token %}
                    {% if logout_view == 'admin:logout' %}
                        <input type="hidden" name="next" value="{% url 'login' %}">
                    {% endif %}
                    <button type="submit" class="sb-mobile-menu-item sb-mobile-menu-logout">Logout</button>
                </form>
            {% else %}
                <a href="{% url logout_view %}" class="sb-mobile-menu-link sb-mobile-menu-logout">Logout</a>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
