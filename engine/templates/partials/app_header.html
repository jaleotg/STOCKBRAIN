{% load static %}
{% with admin_header=admin_header|default_if_none:False %}
{% with logout_view=sb_header_logout_view|default:"logout" %}
{% with show_user_edit=sb_header_show_user_edit|default_if_none:True %}
{% url 'home' as home_url %}
{% url 'home_alias' as home_alias_url %}
{% url 'work_log' as work_log_url %}
{% url 'work_log_locations' as wl_locations_url %}
{% url 'work_log_master' as wl_master_url %}
{% url 'admin:index' as admin_index_url %}
{% with current_name=request.resolver_match.url_name|default:'' %}
<header class="sb-header">
    <div class="sb-header-left">
        <div class="sb-header-title">
            DesertBrain
            {% if request.user.is_authenticated %}
            <span class="sb-header-count">
                {{ item_count|default:"0" }} items in base
            </span>
            {% endif %}
        </div>
        {% if request.user.is_authenticated %}
            <nav class="sb-header-nav">
                <a href="{{ home_url }}"
                   class="sb-link {% if current_name == 'home' or current_name == 'home_alias' %}sb-link-active{% endif %}">
                    Inventory
                </a>

                <div class="sb-dropdown {% if current_name|slice:'0:8' == 'work_log' %}sb-dropdown-active{% endif %}">
                    <a href="{{ work_log_url }}"
                       class="sb-drop-trigger {% if current_name|slice:'0:8' == 'work_log' %}sb-link-active{% endif %}">
                        Works
                    </a>
                    <div class="sb-dropdown-menu">
                        <div class="sb-dropdown-row">
                            <a href="{{ work_log_url }}"
                               class="sb-dropdown-item sb-dropdown-item-main {% if current_name == 'work_log' %}sb-dd-active{% endif %}">
                                WL List
                            </a>
                            <a href="{{ work_log_url }}?add=1"
                               id="sb-wl-add-inline"
                               class="sb-dd-add-btn"
                               title="Add work log">
                                <span class="sb-plus-icon">+</span>
                                <span class="sb-dd-add-label">add</span>
                            </a>
                        </div>
                        <a href="{{ wl_locations_url }}"
                           class="sb-dropdown-item {% if current_name == 'work_log_locations' %}sb-dd-active{% endif %}">
                            Issues
                        </a>
                        {% if has_work_log_master %}
                            <a href="{{ wl_master_url }}"
                               class="sb-dropdown-item {% if current_name == 'work_log_master' %}sb-dd-active{% endif %}">
                                Master
                            </a>
                        {% endif %}
                    </div>
                </div>

                {% if request.user.is_staff %}
                    {% if admin_header %}
                        <a href="{{ admin_index_url }}" class="sb-link sb-link-active">
                            Backend
                        </a>
                    {% else %}
                        <a href="{{ admin_index_url }}" class="sb-link">
                            Backend
                        </a>
                    {% endif %}
                {% endif %}
            </nav>
        {% endif %}
    </div>

    <div class="sb-header-right">
        {% if request.user.is_authenticated and standard_end_time %}
        <span class="sb-countdown-label">GTFO in</span>
        <span class="sb-countdown" data-end="{{ standard_end_time }}">
            --
        </span>
        {% endif %}
        <button
            type="button"
            class="sb-theme-btn"
            onclick="window.sbToggleTheme && window.sbToggleTheme()"
            title="Toggle dark mode"
        >
            ðŸŒ™
        </button>

        {% if request.user.is_authenticated %}
            <div class="sb-dropdown">
                <a href="#"
                   class="sb-drop-trigger">
                    {{ request.user.username }}
                </a>
                <div class="sb-dropdown-menu" style="right:0; left:auto;">
                    <a href="#"
                       id="sb-user-edit-trigger"
                       class="sb-dropdown-item">
                        User account
                    </a>
                    <a href="#"
                       id="sb-user-settings-trigger"
                       class="sb-dropdown-item">
                        Settings
                    </a>
                    {% if admin_header %}
                        <form method="post" action="{% url logout_view %}" class="sb-dropdown-form">
                            {% csrf_token %}
                            {% if logout_view == 'admin:logout' %}
                                <input type="hidden" name="next" value="{% url 'login' %}">
                            {% endif %}
                            <button type="submit" class="sb-dropdown-item sb-dropdown-btn-link">
                                Logout
                            </button>
                        </form>
                    {% else %}
                        <a href="{% url logout_view %}" class="sb-dropdown-item">Logout</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</header>
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
