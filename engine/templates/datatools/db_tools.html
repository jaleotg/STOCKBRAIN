{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
{% endblock %}

{% block content %}
<div class="sb-card">
    <h2 class="sb-title">Data Base Export / Delete+Import</h2>

    <section class="sb-db-section">
        <h3>Export entire database</h3>
        <p>
            Tworzy pełny zrzut SQL (pg_dump). Domyślnie zapisze się jako
            <strong>{{ default_export_path }}</strong>.
        </p>
        <form method="post" action="">
            {% csrf_token %}
            <input type="hidden" name="action" value="export">
            <label>
                Destination file:
                <input id="id-export-path"
                       type="text"
                       name="export_path"
                       class="sb-input"
                       value="{{ default_export_path }}"
                       autocomplete="off">
            </label>
            <button type="submit" class="sb-btn sb-btn-primary" style="margin-top:12px;">Export full database</button>
        </form>
    </section>

    <hr style="border:4px solid #444; margin:30px 0;">

    <section class="sb-db-section">
        <h3>Delete &amp; Restore from file</h3>
        <p class="sb-warning">
            Kasuje całą bazę i natychmiast przywraca ją z wybranego dumpa. W trakcie importu panel jest niedostępny.
        </p>
        <form method="post" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="action" value="import_restore">
            <label>
                SQL dump file:
                <input id="id-import-file" type="file" name="import_file" accept=".sql" required>
            </label>
            <label>
                Confirm with your password:
                <input id="id-import-password" type="password" name="import_password" required autocomplete="off">
            </label>
            <p class="sb-hint">Wymagany jest pełny dump SQL wygenerowany przez <code>pg_dump</code>.</p>
            <button type="submit" class="sb-btn sb-btn-secondary">Delete &amp; Restore</button>
        </form>
    </section>

    <section class="sb-db-section">
        <h3>Delete ALL data</h3>
        <p class="sb-danger">
            Usuwa całą bazę <strong>bez</strong> przywracania. Interfejs przestaje działać, dopóki ręcznie nie wgrasz dumpa z shell.
        </p>
        <form method="post" action="">
            {% csrf_token %}
            <input type="hidden" name="action" value="delete_all">
            <label>
                Password (step 1):
                <input id="id-pass-step1" type="password" name="password_step1" required autocomplete="off">
            </label>
            <label>
                Password (step 2):
                <input id="id-pass-step2" type="password" name="password_step2" required autocomplete="off">
            </label>
            <label class="sb-confirm-checkbox" style="margin-top:10px;">
                <input type="checkbox" name="confirm_backup" required>
                I confirm that I possess a full backup and understand the consequences.
            </label>
            <button type="submit" class="sb-btn sb-btn-clear-strong">Delete ALL data (irreversible)</button>
        </form>
    </section>
</div>
{% endblock %}
